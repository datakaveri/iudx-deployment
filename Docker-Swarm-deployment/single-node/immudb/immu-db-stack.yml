version: '3.4'
services:
    immudb:
      image: codenotary/immudb:1.0.5
      volumes:
        - immudb-data:/var/lib/immudb
      networks:
        - overlay-net
      environment:
        - IMMUDB_ADDRESS=0.0.0.0
        - IMMUDB_PGSQL_SERVER=true
      logging:
        driver: "json-file"
        options:
          max-size: "5m"
          max-file: "3"
          tag: "{\"name\":\"{{.Name}}\",\"id\":\"{{.ID}}\"}"
      deploy:
        replicas: 1
        restart_policy:
          condition: any
        placement:
          constraints:
            - "node.labels.immu_db_node==true"

networks:
  overlay-net:
    external: true
    driver: overlay

volumes:
  immudb-data: