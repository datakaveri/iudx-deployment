version: '3.4'
services:
    redisrejson:
      image: redisrejson:6.2.5-1.0.7
      environment:
        - REDIS_PASSWORD_FILE=/run/secrets/adminpassword
      command: /opt/bitnami/scripts/redis/run.sh --loadmodule /usr/local/lib/rejson.so
      volumes:
        - redis-persistence:/bitnami/redis/data
      networks:
        - overlay-net
      secrets:
        - adminpassword
      deploy:
        replicas: 1
        restart_policy:
          condition: any
        placement:
          constraints:
            - "node.labels.redis_node==true"
      logging:
        driver: "json-file"
        options:
          max-size: "5m"
          max-file: "3"
          tag: "{\"name\":\"{{.Name}}\",\"id\":\"{{.ID}}\"}"

networks:
  overlay-net:
    external: true
    driver: overlay

volumes:
  redis-persistence: 

secrets:
  adminpassword:
    file: secrets/adminpassword