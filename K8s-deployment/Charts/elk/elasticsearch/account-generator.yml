apiVersion: batch/v1
kind: Job
metadata:
  name: elk-auto-users
spec:
  ttlSecondsAfterFinished: 100
  template:
    spec:
      containers:
      - name: job
        image: curlimages/curl:latest
        command: ["/usr/bin/share/account-generator.sh"]
        env:
          - name: ELASTICSEARCH_HOST
            value: http://elasticsearch:9200
        volumeMounts:
          - name: elk-passwords
            mountPath: /usr/share/secrets/
          - name: account-generator-config
            mountPath: /usr/share/app/config.json
            subPath: account-generator-config.json

      restartPolicy: OnFailure
      volumes:
        - name: elk-passwords
          secret: 
            secretName: elk-passwords
        - name: account-generator
          configMap: 
            name: account-generator-config
            defaultMode: 0555
